<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Uploader UX Upgrade</title>
  <script src="https://releases.transloadit.com/uppy/v3.15.0/uppy.min.js"></script>
  <link href="https://releases.transloadit.com/uppy/v3.15.0/uppy.min.css" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #uploadStatus { margin-top: 10px; white-space: pre-line; }
    #uploadBtn { margin-top: 20px; }
  </style>
</head>
<body>

  <h2>File Uploader</h2>
  <div id="uppy"></div>
  <button id="uploadBtn" disabled>Upload</button>
  <div id="uploadStatus">ğŸ”´ No files selected</div>

  <script>
    const uppy = new Uppy({ debug: true, autoProceed: false })
      .use(Uppy.Dashboard, {
        inline: true,
        target: '#uppy',
        showProgressDetails: true,
        note: 'Select files to upload to S3'
      })
      .use(Uppy.XHRUpload, {
        endpoint: 'https://qfiknfbru7xmrtczcqy2767hju0innfi.lambda-url.us-west-2.on.aws/',
        fieldName: 'file',
        bundle: false
      });

    const statusDiv = document.getElementById('uploadStatus');
    const uploadBtn = document.getElementById('uploadBtn');

    function displayStatus(message, isError = false) {
      statusDiv.textContent = message;
      statusDiv.style.color = isError ? 'red' : 'green';
    }

    function updateReadyState() {
      const files = uppy.getFiles();
      if (files.length > 0) {
        displayStatus(`ğŸŸ¢ Ready to upload ${files.length} file(s)`);
        uploadBtn.disabled = false;
      } else {
        displayStatus('ğŸ”´ No files selected', true);
        uploadBtn.disabled = true;
      }
    }

    uppy.on('file-added', updateReadyState);
    uppy.on('file-removed', updateReadyState);

    uploadBtn.addEventListener('click', () => {
      uploadBtn.disabled = true;
      displayStatus('â³ Uploading files...');
      let successCount = 0;
      let failList = [];

      uppy.upload().then((result) => {
        result.successful.forEach(file => successCount++);
        result.failed.forEach(file => failList.push(file.name));

        let message = `âœ… Uploaded ${successCount} file(s) successfully`;
        if (failList.length) {
          message += `\nâŒ Failed: ${failList.join(', ')}`;
        }
        displayStatus(message);
        updateReadyState(); // Recheck files for next round
      });
    });
  </script>

</body>
</html>
