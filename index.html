<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Uppy File Uploader</title>

<!-- Uppy CSS -->
<link href="https://cdn.jsdelivr.net/npm/@uppy/core@3.4.1/dist/style.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@uppy/dashboard@3.4.1/dist/style.min.css" rel="stylesheet">

<!-- Uppy JS -->
<script src="https://cdn.jsdelivr.net/npm/@uppy/core@3.4.1/dist/uppy.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@uppy/dashboard@3.4.1/dist/uppy.min.js"></script>

<!-- Your Uppy Setup -->
<script>
  const uppy = Uppy.Core({
    debug: true,
    autoProceed: false,
  });

  uppy.use(Uppy.Dashboard, {
    inline: true,
    target: '#drag-drop-area',
    showProgressDetails: true,
    proudlyDisplayPoweredByUppy: false,
  });

  uppy.on('upload', async () => {
    for (const file of uppy.getFiles()) {
      const response = await fetch('https://qfiknfbru7xmrtczcqy2767hju0innfi.lambda-url.us-west-2.on.aws/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          filename: file.name,
          filetype: file.type
        })
      });

      const { uploadUrl, key } = await response.json();

      const upload = await fetch(uploadUrl, {
        method: 'PUT',
        headers: { 'Content-Type': file.type },
        body: file.data
      });

      if (upload.ok) {
        console.log(`✅ ${file.name} uploaded to S3`);
      } else {
        console.error(`❌ ${file.name} failed`, await upload.text());
      }
    }

    alert('All files uploaded!');
  });
</script>
  </body>
</html>
